FROM node:20-alpine AS build
WORKDIR /app
COPY package.json package-lock.json* pnpm-lock.yaml* yarn.lock* ./ 2>/dev/null || true
COPY . .
RUN npm ci --silent || npm i
RUN npm run build

FROM nginx:alpine
COPY nginx.conf /etc/nginx/conf.d/default.conf
COPY --from=build /app/dist/ /usr/share/nginx/html/
COPY docker-entrypoint.sh /docker-entrypoint.sh
RUN chmod +x /docker-entrypoint.sh
EXPOSE 8080
ENV PORT=8080
ENV BACKEND_URL="https://actividad3-backend-537174375411.us-central1.run.app"
ENTRYPOINT ["/docker-entrypoint.sh"]
